---
# SPDX-License-Identifier: Apache-2.0
# Copyright Contributors to the Egeria project

# To run
#   * Ensure Docker is installed
#   * Start the tutorial stack using
#     'docker-compose -f ./egeria-tutorial.yaml up'
#   * Go to notebook at http://localhost:18888
#
# See the following link for more info on volumes & why we need to use root:
#   https://docs.bitnami.com/containers/how-to/work-with-non-root-containers/

version: '3.7'

services:

    zookeeper:
        image: 'bitnami/zookeeper:latest'
        environment:
            - ALLOW_ANONYMOUS_LOGIN=yes
        ports:
            - '12181:2181'
        #user: root
        #volumes:
            #- type: volume
            #  source: ./zookeeper_data
            #  target: /bitnami/zookeeper
            #  volume:
            #      nocopy: true

    kafka:
        depends_on:
            - zookeeper
        links:
            - zookeeper
        image: 'bitnami/kafka:latest'
        environment:
            - KAFKA_CFG_ZOOKEEPER_CONNECT=zookeeper:2181
            - ALLOW_PLAINTEXT_LISTENER=yes
        ports:
            - '19092:9092'
        #user: root
        #volumes:
            #- type: volume
            #  source: ./kafka_data
            #  target: /bitnami/kafka
            #  volume:
            #      nocopy: true

    notebook:
        image: 'jupyter/base-notebook:latest'
        environment:
            - GRANT_SUDO=yes
            - CHOWN_HOME=yes
            - JUPYTER_ENABLE_LAB=yes
        command: start.sh jupyter lab --LabApp.token=''
        ports:
            - '18888:8888'
        links:
            - zookeeper
            - kafka
            - egeria
        depends_on:
            - egeria
        #user: root
        #volumes:
            #- type: volume
            #  source: ./notebook_data
            #  target: /home/jovyan/work
            #  volume:
            #      nocopy: true

    egeria:
        depends_on:
            - kafka
        image: 'odpi/egeria:latest'
        ports:
            - '18080:8080'
        links:
            - zookeeper
            - kafka


#volumes:
    #zookeeper_data:
        #driver: local
    #kafka_data:
        #driver: local
    #notebook_data:
        #driver: local
